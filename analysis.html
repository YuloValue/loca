<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><!-- ANPASSUNG: Projektname -->Loca ‚Äì Analyse</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
    body { background: #fff; color: #111; display: flex; flex-direction: column; min-height: 100vh; }

    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 24px 64px; border-bottom: 1px solid #eee;
      font-weight: 600; font-size: 16px;
    }
    header .logo { font-size: 20px; font-weight: 700; }
    header nav a { margin-left: 32px; text-decoration: none; color: inherit; }

    main { flex: 1; padding: 48px 24px; max-width: 900px; margin: auto; }

    h1 { font-size: 30px; font-weight: 700; margin-bottom: 24px; text-align: center; }
    h2 { font-size: 22px; margin-bottom: 16px; color: #222; }

    .score { font-size: 36px; font-weight: 700; margin: 16px 0; color: green; text-align: center; }
    .summary, .einschaetzung { font-size: 17px; color: #444; margin: 16px 0; line-height: 1.6; }
    .section { margin-bottom: 64px; }

    table {
      width: 100%; border-collapse: collapse; margin-top: 16px;
      font-size: 16px; background: #fafafa;
    }
    th, td {
      padding: 14px; border: 1px solid #ddd; text-align: left;
    }
    th { background-color: #f0f0f0; }

    .loader {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #555;
    }

    .error {
      background: #ffe0e0; color: #a00; padding: 16px;
      margin-bottom: 32px; border-radius: 8px; text-align: center;
      font-weight: 600;
    }

    footer {
      margin-top: auto;
      padding: 32px; background-color: #f0f0f0;
      font-size: 14px; color: #777; display: flex;
      justify-content: center; gap: 32px; flex-wrap: wrap;
    }

    @media(max-width: 768px) {
      header { flex-direction: column; align-items: flex-start; padding: 16px 32px; }
      header nav { margin-top: 12px; }
      table, th, td { font-size: 15px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo"><a href="index.html">Loca¬Æ</a></div>
    <nav>
      <a href="analysis.html"><strong>Analyse</strong></a>
      <a href="pricing.html">Preise</a>
      <a href="about.html">√úber Uns</a>
      <a href="profile.html">Profil</a>
      <a href="login.html" id="login-link">Login</a>
    </nav>
  </header>

  <main>
    <h1 id="headline">Analyse wird geladen...</h1>
    <div id="loading" class="loader">üîÑ Standort wird analysiert...</div>

    <div id="content" style="display:none;">
      <section class="section">
        <h2>üè° Standortbewertung</h2>
        <div class="score" id="score">‚Äì</div>
        <div class="summary" id="summary"></div>
      </section>

      <section class="section">
        <h2>üìä Statistiken & Vergleichswerte</h2>
        <div id="statistik"></div>
      </section>

      <section class="section">
        <h2>üß† KI-Einsch√§tzung</h2>
        <div class="einschaetzung" id="einschaetzung"></div>
      </section>
    </div>

    <div id="error" class="error" style="display:none;">Fehler bei der Analyse. Bitte versuche es sp√§ter erneut.</div>
  </main>

  <footer>
    <a href="legal.html">Kontakt / Impressum</a>
    <a href="legal.html">AGB</a>
    <a href="legal.html">Datenschutz</a>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const localData = JSON.parse(localStorage.getItem("analysisData") || "{}");
      const headline = document.getElementById("headline");
      const loading = document.getElementById("loading");
      const errorBox = document.getElementById("error");
      const content = document.getElementById("content");

      if (!localData.address || !localData.projectType) {
        headline.textContent = "Fehler: Keine Adresse angegeben.";
        errorBox.style.display = "block";
        loading.style.display = "none";
        return;
      }

      headline.textContent = `Analyse f√ºr: ${localData.address} ‚Äì ${localData.projectType}`;

      try {
        const response = await fetch("https://hook.eu2.make.com/tupstgshbxd9n6ryg2m6c4ke3g7m8yp7", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(localData)
        });

        if (!response.ok) throw new Error("Antwort nicht erfolgreich");

        const data = await response.json();

        document.getElementById("score").textContent = data.score + " / 10";
        document.getElementById("summary").textContent = data.summary;
        document.getElementById("einschaetzung").textContent = data.einschaetzung;

        const statistikArray = Array.isArray(data.statistik) ? data.statistik : [];

        if (statistikArray.length > 0) {
          const table = document.createElement("table");
          table.innerHTML = "<tr><th>Kategorie</th><th>Wert</th></tr>";
          statistikArray.forEach(entry => {
            const row = document.createElement("tr");
            row.innerHTML = `<td>${entry.Kategorie}</td><td>${entry.Wert}</td>`;
            table.appendChild(row);
          });
          document.getElementById("statistik").appendChild(table);
        }

        loading.style.display = "none";
        content.style.display = "block";

      } catch (error) {
        console.error("Analysefehler:", error);
        errorBox.style.display = "block";
        loading.style.display = "none";
      }
    });
  </script>
</body>
</html>
